<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>化け物から逃げろ!!</title>
    </head>
    <body>
        <div id="start">
            <h1>化け物から逃げろ!!</h1>
            <p>
                ヤバい迷路で化け物から逃げながら宝を集めようぜ!!
            </p>
            <button id="startButton" onclick="start()">スタート</button>
        </div>
        <div id="game" style="display:none">
            <canvas id="canvas" width="500" height="500"></canvas>
        </div>
        <div style="display:none">
            <img src="icon.PNG" id="player"/>
        </div>
        <script>
            function createMaze(width,height){
                if(width%2==0||height%2==0){
                    return;
                }
                let maze=[];
                for(let i=0;i<height;i++){
                    maze.push([]);
                    for(let j=0;j<width;j++){
                        if(i==0||j==0||i==height-1||j==width-1){
                            maze[i].push(1);
                        }else{
                            maze[i].push(0);
                        }
                    }
                }
                
                for(let i=2;i<height-2;i+=2){
                    for(let j=2;j<width-2;j+=2){
                        maze[i][j]=1;
                        let random=Math.floor(Math.random()*4);
                        switch(random){
                            case 0:
                            maze[i-1][j]=1;
                            break;
                            case 1:
                            maze[i+1][j]=1;
                            break;
                            case 2:
                            maze[i][j-1]=1;
                            break;
                            case 3:
                            maze[i][j+1]=1;
                            break;
                        }
                    }
                }

                return maze;
            }

            let maze,timer,keys=[],player={x:1,y:1};
            let canvas=document.getElementById('canvas');
            let ctx=canvas.getContext('2d');
            let playerImage=document.getElementById('player');

            addEventListener('keydown',(e)=>{
                keys[e.keyCode]=true;
            });

            addEventListener('keyup',(e)=>{
                keys[e.keyCode]=false;
            });

            function getDisplayText(map,player){
                let text="";
                for(let i=0;i<map.length;i++){
                    for(let j=0;j<map[i].length;j++){
                        if(i==player.y&&j==player.x)
                            text+=":)";
                        else
                            if(map[i][j])
                                text+="||";
                            else
                                text+="  ";
                    }
                    text+="\n";
                }
                return text;
            }

            function loop(){
                if(keys[87]){
                    if(!maze[player.y-1][player.x])
                        player.y--;
                }else if(keys[83]){
                    if(!maze[player.y+1][player.x])
                        player.y++;
                }else if(keys[65]){
                    if(!maze[player.y][player.x-1])
                        player.x--;
                }else if(keys[68]){
                    if(!maze[player.y][player.x+1])
                        player.x++;
                }
                ctx.fillStyle='#eedcb3';
                ctx.fillRect(0,0,500,500);
                ctx.fillStyle='#11aa00';
                drawMap(ctx,maze,225-player.x*50,225-player.y*50,50,50);
                ctx.drawImage(playerImage,225,225,50,50);
            }

            function init(){
                maze=createMaze(51,27);
                timer=setInterval(loop,100);
            }

            function start(){
                document.getElementById('start').style.display='none';
                document.getElementById('game').style.display='block';
                init();
            }

            function drawMap(ctx,map,x,y,mapChipWidth,mapChipHeight){
                for(let i=0;i<map.length;i++){
                    for(let j=0;j<map[i].length;j++){
                        if(map[i][j])
                            ctx.fillRect(x+j*mapChipWidth,y+i*mapChipHeight,mapChipWidth,mapChipHeight);
                    }
                }
            }
        </script>
    </body>
</html>